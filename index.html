<HTML>
	<head>
		<script type="text/javascript" src="leksikon.json"></script>
		<script type="text/javascript" src="sequence.json"></script>
	</head>
	<body>
		<div id="title">
			<h1>WOW! It's the <em>Leksikon Shpil</em></h1>
			<h2>Whose article does this sentence come from?</h2>
		</div>
		<div id="quiz">
			<p id="bio">
			</p>
			<p id="status">
			</p>
			<div id="options">
				<button onclick="check(this)" class="answer_button" id="answer0" type="button"></button>
				<button onclick="check(this)" class="answer_button" id="answer1" type="button"></button>
				<button onclick="check(this)" class="answer_button" id="answer2" type="button"></button>
				<button onclick="check(this)" class="answer_button" id="answer3" type="button"></button>
				<button onclick="check(this)" class="answer_button" id="answer4" type="button"></button>
				<button onclick="check(this)" class="answer_button" id="answer5" type="button"></button>
				<button onclick="check(this)" class="answer_button" id="answer6" type="button"></button>
			</div>
			<p id="name"></p>
		</div>

		<script>
			function getRandomInt(max) {
				return Math.floor(Math.random() * max);
			}

			function hint(){
				if (guesses > 1) {
					var prev = guesses-1;
					document.getElementById("highlight" + prev).style.background = "none";
				}


				document.getElementById("bio").insertAdjacentHTML('beforeend'," <span class='highlight' id='highlight" + guesses + "'>" +  random_entry["content"][sentence_sequence[guesses]] + "</span>");

				document.getElementById("highlight" + guesses).style.background = "pink";
			}

			function check(guess) {
				guesses += 1;
				if (guess.innerHTML==random_entry["name"]) {
					document.getElementById("status").innerHTML = "Correct!!";
				} else {
					if (guesses < 5) {
						guess.disabled = true;
						hint();
						if (guesses == 4) {
							document.getElementById("status").innerHTML = "Last try!";
						} else {
						document.getElementById("status").innerHTML = "You need some more help...";
						}
					} else {
						document.getElementById("status").innerHTML = "You don't know nothin' about Yiddish writers.";
						if (guesses == 5) {
							guess.disabled = true;
						}
						document.getElementById("answer" + answer_index).style.background = "pink";
					}
				}
			}
			/*

			if selection is wrong:
				make wrong selection unclickable
				update "tries" counter visible to use
				provide new random sentence from bio
			right:
				celebrate
				display total tries
				display full bio
		  */


			// today is days since epoch - x days. 20118 is days since epoch on jan 29, 2025
			today = Math.floor(Date.now()/8.64e7) - 20118;
			random_entry = leksikon[sequence[today][0]];
			sentence_sequence = sequence[today][2];
			// the correct answer must be inserted randomly among answer_choices (note that unless all answer choices are shuffled, the answer reveals itself on refresh by being the only to change positions)
			answer_choices = [leksikon[sequence[today][1][0]]["name"], leksikon[sequence[today][1][1]]["name"], leksikon[sequence[today][1][2]]["name"], leksikon[sequence[today][1][3]]["name"], leksikon[sequence[today][1][4]]["name"], leksikon[sequence[today][1][5]]["name"]];
			answer_index = getRandomInt(7);
			answer_choices.splice(answer_index, 0, random_entry["name"]);
			for (let i = 0; i < answer_choices.length; i++) {
  			document.getElementById("answer" + i).innerHTML = answer_choices[i];
			}

			random_sentence = random_entry["content"][sentence_sequence[0]];
			document.getElementById("bio").innerHTML = random_sentence;

			guesses = 0

		</script>
		<style>
		body {
			width: 100%;
		}
		#title {
			text-align: center;
		}
		#quiz {
			font-size: 1.5em;
			width: 65%;
			margin: auto;
		}
		#bio {
			border: .2em dashed green;
			padding: .5em;
			border-radius: .3em;
		}
		#options {
			width: 100%;
			margin: auto;
			text-align: center;
		}
		.answer_button {
			padding: .2em;
			margin: .3em;
			font-size: 1em;

		}
		#status {
			text-align: center;
			background-color: pink;
		}
		</style>
	</body>
</HTML>
